---
title: "13. User Created Functions"
author: "Geraldo B. Padilla F."
date: "29-03-2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# When to create a function

```{r}
library(tidyverse)

midwest

midwest <- midwest%>%
  mutate(
    stand_poptotal = (poptotal  - mean(poptotal)) / sd(poptotal)
  )
select(midwest, poptotal, stand_poptotal)

standardize <- function(x){
  mean_var <- mean(x)
  sd_var <- sd(x)
  (x - mean_var) / sd_var
}

midwest <- midwest%>%
  mutate(
    stand_poptotal2 = standardize(poptotal)
  )
select(midwest, poptotal, stand_poptotal, stand_poptotal2)

scale(midwest$poptotal)
```

## Conditional summarise() or mutate() statements

One thing I want to show briefly is if you are attempting to apply a particular function for data verification and there is a function already defined in R, summarise_if() or mutate_if() can be particularly useful. Take an example of wanting to calculate the mean of each numeric column, but the data has a mix of numeric and categorical variables. You could write multiple computations within mutate() or summarise(), but summarise_if() and mutate_if() can be particularly useful.

```{r}
mpg

summarise_if(mpg, is.numeric, mean, na.rm = T)

mpg%>%
  group_by(manufacturer)%>%
  summarise_if(is.numeric, list(mean,sd), na.rm = T)
```

## Function Basics

Every function has three basic components, a function name, a function definition (i.e. arguments), and the function specifics/computations or function body

```{r}
function_name <- function(argument1, argument2){
  function_body
}

standardize <- function(x){
  mean_var <- mean(x)
  sd_var <- sd(x)
  (x - mean_var) / sd_var
}

library(nycflights13)

flights%>%
  mutate(
    stand_arr_delay = standardize(arr_delay))%>%
  select(arr_delay, stand_arr_delay)

standardize <- function(x, na.rm = T){
  mean_var <- mean(x, na.rm = T)
  sd_var <- sd(x, na.rm = T)
  (x - mean_var) / sd_var
}

flights%>%
  mutate(stand_arr = standardize(arr_delay))%>%
  select(arr_delay, stand_arr)
```

## Conditional Logic in Functions

```{r}
if(some_condition){
  # do something
} else {
    # do something else
}

library(e1071)

mean_median <- function(variable, na.rm = T){
  var_skew <- skewness(variable, na.rm = T)
  
  if(abs(var_skew)>2){
    descriptive <- median(variable, na.rm = T)
  } else {
    descriptive <- mean(variable, na.rm = T)
  }
  data.frame(skewness = var_skew,
             descriptive = descriptive)
}

mean_median(flights$arr_delay)
mean_median(gss_cat$tvhours)
mean_median(diamonds$price)

mean_median_arg <- function(variable, statistic = 'mean', na.rm = T, skewness = F){
  if(statistic == 'mean'){
    descriptive <- mean(variable, na.rm = na.rm)
  } else {
    descriptive <- median(variable, na.rm = na.rm)
  }
  
  if(skewness){
    skewness_stat <- skewness(variable, na.rm = na.rm)
  } else {
    skewness_stat <- NA
  }
  
  data.frame(skewness_stat, descriptive)
}

mean_median_arg(flights$arr_delay)
mean_median_arg(flights$arr_delay, statistic = 'median', skewness = T)
```

## Larger Conditional Branching

```{r}
if(some_condition) {
  # do something computationally
} else if (another_condition) {
  # do another computation
} else if (yet_another_condition) {
  # do yet another computation
} else {
  # final computation
}

desc_stats <- function(variable,
                       statistic = c('mean', 'sd', 'median', 'quantile')){
  if(statistic == 'mean'){
    mean(variable, na.rm = T)
  } else if(statistic == 'sd'){
    sd(variable, na.rm = T)
  } else if(statistic == 'median'){
    median(variable, na.rm = T)
  } else {
    quantile(variable, na.rm = T)
  }
}

desc_stats(flights$arr_delay, statistic = 'mean')
desc_stats(flights$arr_delay, statistic = 'sd')
desc_stats(flights$arr_delay, statistic = 'median')
desc_stats(flights$arr_delay, statistic = 'quant')

desc_stats_sw <- function(variable,
                          statistic = c('sd', 'mean', 'median', 'quantile')){
  switch(statistic,
         sd = sd(variable, na.rm = T),
         mean = mean(variable, na.rm = T),
         median = median(variable, na.rm = T),
         quantile = quantile(variable, na.rm = T),
         stop('Unknown statistic argument'))
}

desc_stats_sw(flights$arr_delay, statistic = 'mean')
desc_stats_sw(flights$arr_delay, statistic = 'sd')
desc_stats_sw(flights$arr_delay, statistic = 'median')
desc_stats_sw(flights$arr_delay, statistic = 'quantile')
```

## Thinking about Returned Values