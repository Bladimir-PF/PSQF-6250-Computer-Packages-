---
title: "Introduction to Markdown"
author: "Geraldo B. Padilla F."
date: "January 23, 2022"
output: html_document
---

# Week 1 Introduction

Text is written in Markdown. This is a simple markup language that takes care of formatting and allows for quick easy formatting.

1. Sample Title
To create a new paragraph, just include a blank line.

**Bold** or *italics* can be done easily. Also can use __bold__ or _italics_. Code can be shown in monospace with backticks `code example`.

## Level 2 Header
Lists are easy:  

- Unordered
- List   
   * Nested version list
   + Idea 2
- Third

### Ordered Lists
Use numbers to create ordered list:  

1. first
1. second
3. third
7. fourth

3. Create Links
Links are easy, two different versions.   
[Markdown Syntax](http://daringfireball.net/projects/markdown)   
<http://daringfireball.net/projects/markdown>

4. Images are similar
![alt text](https:x.png "UI Logo")
5. Tables
Tables are also simple.

| Column 1 | Column 2 |
|----------|----------|
| Text     | Text     | 
| Text     | Text     | 


6. Block Quotes
Block quotes:

 > This is an example of a block quote
 > that is wrapped. The text will be indented
 > as a block quote automatically.
 

7. Line Break  
A line break can be made with three or more dashed or asterisks

8. Dynamic Documents

8.1 Using markdown, R code can be directly embedded into the document.
```{r}
x <- rnorm(100)
y <- runif(100, min = 3, max = 8)
mean(x)
mean(y)
```

8.2 Showing additional code options

- Do not show syntax
```{r, echo = FALSE}
x <- rnorm(100)
y <- runif(100, min = 3, max = 8)
mean(x)
mean(y)
```

- Do not print results
```{r, results = "hide"}
x <- rnorm(100)
y <- runif(100, min = 0, max = 1)
mean(x)
mean(y)
```

- Automatically include figures
```{r fig, fig.width = 8, fig.height = 6}
x <- rnorm(100)
y <- runif(100, min = 3, max = 8)
plot(x, y)
```

The `knitr` website has additional chunk options <http://yihui.name/knitr/options/>. You can even set global options by doing something like the following:

```{r global_opts, eval = FALSE}
knitr::opts_chunk$set(fig.width = 8, fig.height = 6, echo = FALSE,
                      warning = FALSE, message = FALSE)
```

9. Inline code
`knitr` also has the ability to run code inline. Therefore, if we wanted to report the correlation between `x` and `y` reported above, we can do that. 

```{r, echo=FALSE}
a = cor(x,y)
```

For example, the correlation between student test scores (x) and the student grade (y) is
`r round(cor(x, y), 3)`.

Another options is to use inline code linking the r options with an object created in a previous chunk = `r a`

10. Compile document
The easiest way to compile the document is to use the "Knit" button in Rstudio. This button will directly compile the document into an html file based on the specification of the `output` option at the top of this file. Changing the `output` options can produce a pdf (`output: pdf_document`) or a word file (`output: word_document`).

Another option is to compile the `.Rmd` file with knitr, then use [pandoc](http://pandoc.org/) to convert it to another option via the command line. You could also use the `rmarkdown` package in R which will include both the `knitr` package and the `pandoc` program. More information can be found here: <http://kbroman.org/knitr_knutshell/pages/Rmarkdown.html>

# Week 2 ggplot2

```{r}
library(tidyverse)
midwest = data.frame(midwest)
attach(midwest)
knitr::opts_chunk$set(fig.width = 6, fig.height = 6)
```

1. Graphics
```{r}
ggplot(midwest)+
  geom_point(aes(county, state))

ggplot(midwest)+
    geom_point(aes(popdensity, percollege), shape = 15)

ggplot(data = midwest) + 
  geom_point(mapping = aes(x = popdensity, y = percollege, color = state))+
  theme_bw()
```

2. Facets
```{r}
ggplot(data = midwest)+
    geom_point(mapping = aes(x = popdensity, y = percollege, color = state))+
    facet_grid(.~ state)

ggplot(data = midwest)+
    geom_point(mapping = aes(x = popdensity, y = percollege, color = state))+
    facet_grid(state ~ .)

ggplot(data = midwest)+
    geom_point(mapping = aes(x = popdensity, y = percollege, color = state))+
    facet_wrap(~ state)

ggplot(data = midwest)+
    geom_point(mapping = aes(x = popdensity, y = percollege, color = state))+
    facet_grid(inmetro ~ state)

# the dot means 'do not put anything on the rows'.
```

3. Geoms
```{r}
ggplot(midwest)+
    geom_smooth(aes(popdensity, percollege))

ggplot(midwest, aes(popdensity, percollege))+
  geom_point(aes(color = 'blue'))

ggplot(midwest, aes(popdensity, percollege))+
  geom_line(aes(linetype = state, color = state))+
  theme_grey()

ggplot()

ggplot(midwest)+
    geom_smooth(aes(popdensity, percollege, linetype = state), se = FALSE)
```

4. Combining multiples Geoms
```{r}
ggplot(data = midwest)+
    geom_smooth(mapping = aes(popdensity, percollege, linetype = 'solid', color = state), se = FALSE)+
    geom_point(mapping = aes(popdensity, percollege, color = state))

ggplot(midwest, aes(x=popdensity, y=percollege, color = state))+
    geom_point()+
    geom_smooth(se = FALSE, linetype = 'dashed')

ggplot(midwest, aes(x=popdensity, y=percollege))+
    geom_point(aes(color = state))+
    geom_smooth(se = FALSE)
```

5. Geoms for single variables
```{r}
ggplot(midwest, aes(state))+
    geom_bar()

ggplot(midwest, aes(state))+
    geom_bar(aes(fill = factor(inmetro)))

ggplot(midwest, aes(state))+
    geom_bar(aes(fill = factor(inmetro)), position = 'fill')

prop.table(table(state, factor(inmetro)), 1)

ggplot(data = midwest, mapping = aes(x = state)) + 
  geom_bar(aes(fill = factor(inmetro)), position = 'dodge')

ggplot(midwest, aes(popdensity))+
  geom_histogram(binwidth = 1000)

ggplot(midwest, aes(popdensity))+
  geom_density(aes(color=state))

ggplot(midwest, aes(state, popdensity))+
  geom_boxplot(aes(color = state))+
  facet_grid(.~factor(inmetro))

ggplot(data = midwest, mapping = aes(x = popdensity, y = percollege, color = state)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  scale_x_continuous("Population Density") + 
  scale_y_continuous("Percent College Graduates") + 
  scale_color_discrete("State") + 
  coord_cartesian(xlim = c(0, 15000))

ggplot(midwest, aes(popdensity, percollege, color = state))+
  geom_point()+
  geom_smooth(se = FALSE)+
  scale_x_continuous('Pop Dens', limits = c(0, 5000))+
  scale_y_continuous('Percollege')+
  scale_color_discrete('State')+
  theme_bw()
```

---

# Week 3 ggplot2 Extensions

```{r}
library("ggrepel")
library("ggforce")
library("patchwork")
library('palmerpenguins')
library('ggthemes')
library(tidyr)
attach(penguins)
theme_set(theme_bw(base_size = 14))
```


## ggrepel
```{r}
names(penguins)
ggplot(penguins, aes(flipper_length_mm, bill_length_mm))+
  geom_point(size = 2, aes(shape = species))+
  geom_text_repel(aes(label = species))
  xlab('Flipper')+
  ylab('Bill')
#theme(legend.position="none") it removes the legend
  
set.seed(100)
penguins%>%
  group_by(species)%>%
  sample_n(10)%>%
  ggplot(., aes(flipper_length_mm, bill_length_mm))+
  geom_point(size = 4, aes(shape = species))+
  geom_label_repel(aes(label = species))+
  xlab('Flipper')+
  ylab('Bill')
```

## ggforce: it requires complete cases
```{r}
penguins%>%
  drop_na(flipper_length_mm, bill_length_mm)%>%
ggplot(., aes(flipper_length_mm, bill_length_mm))+
  geom_point(aes(shape = species), size = 3)+
  geom_mark_ellipse(aes(fill = species, label = species))
  scale_x_continuous('Flipper')+
  scale_y_continuous('Bill', limits = c(25, 70))

ggplot(penguins, aes(flipper_length_mm, bill_length_mm))+
  geom_point(aes(shape = species, color = species), size = 3)+
  xlab('Flipper')+
  ylab('Bill')+
  facet_zoom(y = species == 'Gentoo')
```

## ggsignif (it requires more evidences)
```{r}
library("ggsignif")
ggplot(penguins, aes(flipper_length_mm, bill_length_mm)) +
  geom_boxplot()+
  geom_signif(comparisons = list(c("Adelie", "Chinstrap")), map_signif_level = TRUE, textsize = 6)
```

## patchwork
```{r}
p1 = ggplot(penguins, aes(flipper_length_mm, bill_length_mm))+
  geom_point(size = 4, aes(color = species, shape = species))+
  xlab('Flipper')+
  ylab('Bill Length')+
  theme(legend.position = 'none', axis.title=element_text(size=10,face="bold"),
        axis.text=element_text(size=6))

p2 = ggplot(penguins, aes(flipper_length_mm, bill_depth_mm))+
  geom_point(size = 4, aes(color = species, shape = species))+
  xlab('Flipper')+
  ylab('Bill Length')+
  theme(legend.position = 'none', axis.title=element_text(size=10,face="bold"),
        axis.text=element_text(size=6))

p3 = ggplot(drop_na(penguins, sex), aes(sex, body_mass_g))+
  geom_violin(aes(fill = species), draw_quantiles = c(.1, .5, .9))+
  xlab('Sex')+
  ylab('Boddy mass')+
  theme(legend.position = 'none', axis.title=element_text(size=10,face="bold"),
        axis.text=element_text(size=6))



p1+p2
p1/p2
p3|(p1/p2)
(p1 + p2) / p3
```

---

# Week 4 Data Manipulation

## Book chapter 5: Data transformation (R for Data Science)

```{r}
library(nycflights13)
library(tidyverse)
```

### 5.5 Add new variables with mutate()
```{r}
flights_sml <- select(flights, 
  year:day, 
  ends_with("delay"), 
  distance, 
  air_time)

mutate(flights_sml,
  gain = dep_delay - arr_delay,
  speed = distance / air_time * 60)

mutate(flights_sml,
  gain = dep_delay - arr_delay,
  hours = air_time / 60,
  gain_per_hour = gain / hours)

transmute(flights,
  gain = dep_delay - arr_delay,
  hours = air_time / 60,
  gain_per_hour = gain / hours)
```

```{r, message=FALSE}
install.packages('fivethirtyeight')
install.packages('fivethirtyeightdata', repos = 'https://fivethirtyeightdata.github.io/drat/', type =
'source')
library(fivethirtyeight)
library(tidyverse)
library(dplyr)
```

## Filter (rows)
```{r}
(congress_80 = filter(congress_age, congress == 80))
(senate = filter(congress_80, chamber == 'senate'))
filter(congress_age, congress ==80, chamber == 'senate')
filter(congress_age, congress == 80 | congress == 81)
filter(congress_age, congress %in% c(80,81))
filter(congress_age, congress !=80)
filter(congress_age, congress == 80 & !chamber == 'senate')
filter(congress_age, party =='D' & congress ==100) #democrats from the 100th congress
filter(congress_age, age > 79) #congress members who are older than 80 years
```

## Exercise to select NA's
```{r}
df = tibble(x = c(200, 30, NA, 45, 212))
filter(df, x > 199) #all values greater than 200
filter(df, x %in% c(200, 212, NA))
```

## Arrange
```{r}
arrange(congress_age, state, party)
arrange(congress_age, desc(congress)) #descending order

congress_age%>%
filter(congress == 80 & chamber == 'house', party =='D')%>%
  arrange(state, age)
```

## Select (columns)
```{r}
select(congress_age, congress, chamber, party, age)
select(congress_age, contains('name'))
select(congress_age, ends_with('name'))
select(congress_age, congress:birthday)
select(congress_age, -congress, -chamber) #Select all variables except this one. 
all.equal(a, b)

rename(congress_age, a = chamber)
```

### Exercises
```{r}
select(congress_age, starts_with('c'))
names(congress_age)
a = rename(congress_age, x1=congress, x2=chamber, x3=bioguide)
select(a, num_range('x',1:3))
```

## Mutate (add columns to the dataset)
```{r}
congress_red = select(congress_age, congress, chamber, state, party)
mutate(congress_red,
       democrat = ifelse(party == 'D', 1, 0),
       num_democrat = sum(democrat))
```

### Exercises
```{r}
names(diamonds)
a = select(diamonds, carat, price)
b = a%>%
  mutate(price_per_carat = price/carat,
         rank = min_rank(price_per_carat))%>%
  arrange(rank)%>%
  select(price, rank)
c = a%>%
  mutate(rank = min_rank(price))%>%
  arrange(rank)%>%
  select(price, rank)
all.equal(b, c)
```

## Summarise (it collpases all the data into one row)
```{r}
congress2 = mutate(congress_age,
                   democrat = ifelse(party == 'D', 1, 0))
summarise(congress2,
          num_democrat = sum(democrat))

congress_grp = group_by(congress2, congress)
summarise(congress_grp,
          num_democrat = sum(democrat),
          total = n(),
          prop_democrat = num_democrat/total)
```

### Exercise
```{r}
rep = congress_age%>%
  group_by(congress)%>%
  mutate(reps = ifelse(party == 'R', 1, 0))%>%
  summarise(count = sum(reps),
            repb = mean(reps),
            total = n(),
            prop_rep = repb/total,
            prop_rep2 = count/total)

congress_age%>%
  group_by(congress)%>%
  summarise(youngest = min(age),
          oldest = max(age))

congress_age%>%
  group_by(congress)%>%
  arrange(age)%>%
  summarise(
    youngest = first(age),
    oldest = last(age))

group_by(congress_age, congress, party)%>%
  summarise(total = n())
```

## Chaining commands together
```{r}
congress_age%>%
  filter(congress >= 100)%>%
  group_by(congress, chamber)%>%
  mutate(democrat = ifelse(party == 'D', 1, 0))%>%
  summarise(
    n_democrats = sum(democrat),
    total = n(),
    prop_democrat = n_democrats/total)

summarise(
  mutate(
    group_by(
      filter(congress_age, congress >= 100),
    congress, chamber),
  democrat = ifelse(party == 'D', 1, 0)),
n_democrats = sum(democrat),
total = n(),
prop_democrats = n_democrats/total)
```

### Exercise
```{r}
diamonds%>%
  filter(color %in% c('D', 'E', 'F') & cut %in% c('Fair', 'Good', 'Very Good'))%>%
  group_by(clarity)%>%
  mutate(f_color = ifelse(color == 'F', 1, 0),
         vg_cut = ifelse(cut == 'Very Good', 1, 0))%>%
  summarise(
    avg = mean(carat),
    sd = sd(carat),
    avg_p = mean(price),
    num = n(),
    summary_f_color = mean(f_color),
    summary_vg_cut = mean(vg_cut))

summarise(
  group_by(
    mutate(
      filter(
        diamonds, 
        color %in% c('D', 'E', 'F') & cut %in% c('Fair', 'Good', 'Very Good')
      ),
      f_color = ifelse(color == 'F', 1, 0),
      vg_cut = ifelse(cut == 'Very Good', 1, 0)
    ),
    clarity
  ),
  avg = mean(carat),
  sd = sd(carat),
  avg_p = mean(price),
  num = n(),
  summary_f_color = mean(f_color),
  summary_vg_cut = mean(vg_cut)
)
```



# Week 5 Exploratory Data Analysis

```{r}
library(nycflights13)
library(tidyverse)
```

## Missing data
```{r}
flights
summary(flights)
filter(flights, is.na(dep_time))
filter(flights, is.na(arr_delay) & !is.na(arr_time))
flights%>%
  mutate(miss_arrival = is.na(arr_time))%>%
  ggplot(aes(sched_arr_time, ..density..))+
  geom_freqpoly(aes(color = miss_arrival))+
  theme_bw()
```

## Variation
```{r}
#Qualitative variables
ggplot(flights, aes(as.factor(month)))+
  geom_bar()+
  theme_bw()

ggplot(flights, aes(month))+
  geom_bar()+
  theme_bw()+
  xlim(0, 13)

flights%>%
  count(cut_width(month, 1))

#Quantitative variables
ggplot(flights, aes(distance))+
  geom_histogram(bandwith = 30)+
  theme_bw()

ggplot(flights, aes(distance))+
  geom_freqpoly(aes(color = as.factor(month)))+
  theme_bw()

ggplot(flights, aes(distance))+
  geom_density(aes(color = as.factor(month)))+
  theme_bw()

ggplot(flights, aes(distance))+
  geom_histogram(bandwith = 100)+
  theme_bw()

flights%>%
  count(month, cut_width(distance, 100))

flights%>%
  summarize(
    var = var(distance, na.rm = TRUE),
    sd = sd(distance, na.rm = TRUE),
    min = min(distance, na.rm = T),
    max = max(distance, na.rm = T))
```

## Covariation
```{r}
flights%>%
  select(day, month)%>%
  summary()

ggplot(flights, aes(as.factor(month), as.factor(day)))+
  geom_count()+
  theme_bw()

flights%>%
  count(month, day)%>%
  ggplot(aes(as.factor(month), as.factor(day)))+
  geom_tile(aes(fill = n))+
  theme_bw()

flights%>%
  count(origin, carrier)%>%
  ggplot(aes(origin, carrier))+
  geom_tile(aes(fill = n))+
  theme_bw()

ggplot(flights, aes(air_time, arr_delay))+
  geom_point(alpha = .05)+
  theme_bw()

ggplot(flights, aes(air_time, arr_delay))+
  geom_boxplot(aes(group = cut_width(air_time, 50)))+
  theme_bw()

ggplot(flights, aes(air_time, arr_delay))+
  geom_hex()+
  theme_bw()

ggplot(flights, aes(air_time, arr_delay))+
  geom_bin2d()+
  theme_bw()
```

### Adding a third variable
```{r}

```

### Exercise
```{r}
flights%>%
  count(month)
count(flights, month, day)
df = data.frame(table(flights$day))
colnames(df) <-  c('day', 'n')
arrange(df, desc(n))

ggplot(flights, aes(air_time))+
  geom_density(aes(color = as.factor(month)))+
  theme_bw()
```