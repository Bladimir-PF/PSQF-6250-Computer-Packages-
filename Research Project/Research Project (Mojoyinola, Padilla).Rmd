---
title: "<center> <h1>Exploring the probabilities of being admitted to university in Chile based on socioeconomic and academic attributes</h1> </center>"
author:
- name: Mubarak Mojoyinola and Geraldo Padilla
  affiliation: The University of Iowa
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    theme: simplex
    highlight: textmate
  word_document: default
bibliography: references.bib
csl: apa.csl
tags:
- PSU
- Admission tests
abstract: |
  This project analyzes the probabilities of being admitted to university in Chile in the 2021 admission process. Admission is based on PSU results and other 2 criteria associated with academic performance during high school (GPA and Ranking), however, there could be  other 'non-academic' criteria interfering in the opportunities to being admitted (socioeconomic background).
---

<style type="text/css">
body{
  font-family: Arial;
  font-size: 12pt;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = F)
```

```{r, messages = F}
library(easypackages)
libraries('tidyverse', 'ggplot2', 'glm2', 'VGAM', 'multcomp', 'stringr', 'readxl', 'Lahman', 'kableExtra')
```

## Introduction

In Chile, the higher education system is made up of technical training centers, professional institutes and universities. The entrance to the universities has a dual behavior. On the one hand, there is a group of selective institutions (public and private) that define a shared set of rules and procedures for admitting students, known as the Single Admission System (SAS); on the other hand, there is a set of private institutions that can establish autonomous selection mechanisms [@espinoza2013equidad].

The SAS is a process divided into four stages: registration, administration of tests, application and selection. In this process, students who have just graduated from secondary education who want to enter higher education mainly participate. The selection tests (also known as PSU) that must be taken measure knowledge of Mathematics, Language, Social Sciences and Natural Sciences, which are necessary to study university careers (DEMRE, 2015). The results in these tests are part of a composite score with which students apply to different programs. In addition to the tests, the scores derived from the high school grades (NEM) and the position that students obtained in their high school of graduation (Ranking) are important.

Composite score may vary across programs. Usually, scores in Mathematics and Language are mandatory, while Social and Natural Sciences are required in specific cases. PSU tests can weigh up to 60% of the composite score; the other 40% is distributed between the NEM and the Ranking (Larroucau, 2014).

The chances of being selected for university are strongly linked to performance on the PSU tests (Larroucau, Ríos, & Mizala, 2015). The drawback is that various research findings have shown that PSU performance is conditioned by the socioeconomic characteristics of the students [@medina2014predictibilidad; @santelices2018high]. Among the most important variables to enter the university were family income, parental education and the sector of the graduating school (Brunner, 2010; Leyton, Vásquez and Fuenzalida, 2012; Gil, Frites and Muñoz, 2014).

For this reason, in the last two decades, several educational reforms have been implemented to reduce selection bias (Chiroleu, 2009; Bellei, 2013). Some researchers have proposed reducing the weight of the PSU in the composite scores and increasing the relevance of the NEM and the Ranking, since these scores would be less affected by educational segmentation (Gil and Canto, 2012; Meneses and Toro, 2012 ; Román, 2012; Gil, Paredes and Sánchez, 2013; Bellei, 2018).

In summary, the results of several investigations suggest that admission to selective universities in Chile should be constantly examined. The objective of this project is to explore the possibilities that students have to enter higher education, especially when considering the effect of different economic and cultural backgrounds. Data analysis includes exploration of means, relative frequencies, and estimation of a binary logistic regression model.

## Description of data

```{r}
registration <- read_csv2("C:/Users/geral/OneDrive - University of Iowa/CIDCIE/1. Bases de Datos/PSU/PSU 2019 - 2021/A_Inscritos_puntajes/A_INSCRITOS_PUNTAJES_PDT_2021_PUB_MRUN.csv")

socioeconomic <- read_csv2("C:/Users/geral/OneDrive - University of Iowa/CIDCIE/1. Bases de Datos/PSU/PSU 2019 - 2021/B_Socioeconomico/B_SOCIOECONOMICO_DOMICILIO_PDT_2021_PUB_MRUN.csv")

application <-read_csv2("C:/Users/geral/OneDrive - University of Iowa/CIDCIE/1. Bases de Datos/PSU/PSU 2019 - 2021/C_Postulacion_Seleccion/C_POSTULANTES_SELECCION_PDT_2021_PUB_MRUN.csv")

admission <- read_csv2("C:/Users/geral/OneDrive - University of Iowa/CIDCIE/1. Bases de Datos/PSU/PSU 2019 - 2021/D_Matricula_MRUN/D_MATRICULA_PDT__2021_PUB_MRUN.csv")
```

```{r}
a <- registration%>%
  dplyr::select(MRUN, COD_SEXO, RBD, CODIGO_ENS, RAMA_EDUCACIONAL,
         DEPENDENCIA, PROMEDIO_NOTAS, PTJE_NEM, PTJE_RANKING,
         CLEC_ACTUAL, MATE_ACTUAL, PUNTAJES_PROCESO)%>%
  dplyr::filter(PUNTAJES_PROCESO == 1 & CODIGO_ENS %in% c('310', '410', '510', '610'))%>%
  dplyr::select(MRUN, COD_SEXO, RBD, RAMA_EDUCACIONAL, DEPENDENCIA,
  PROMEDIO_NOTAS, PTJE_NEM, PTJE_RANKING, CLEC_ACTUAL,MATE_ACTUAL)%>%
  mutate(
    gender = ifelse(COD_SEXO == 2, 1,0),
    type_hs = ifelse(RAMA_EDUCACIONAL == 'H1', 0,1),
    sector = ifelse(DEPENDENCIA == 3|DEPENDENCIA == 4, 1,0))%>%
  dplyr::select(MRUN,RBD,PROMEDIO_NOTAS, PTJE_NEM, PTJE_RANKING, CLEC_ACTUAL,MATE_ACTUAL,gender, type_hs,sector)

colnames(a) <- c('MRUN', 'RBD', 'gpa', 'NEM', 'RKG', 'LEN', 'MATH', 'gender', 'type_hs','sector')

b <- socioeconomic%>%
  dplyr::select(MRUN, INGRESO_PERCAPITA_GRUPO_FA, EDUCACION_MADRE, EDUCACION_PADRE)
ab <- left_join(a, b, by = 'MRUN')

ab <- ab%>%
  mutate(
    inc = INGRESO_PERCAPITA_GRUPO_FA,
    ed_m = EDUCACION_MADRE,
    ed_d = EDUCACION_PADRE,
    ed_dad = ifelse(ed_d >= 0 & ed_d <=5, 0,
                    ifelse(ed_d >= 6 & ed_d <= 9, 1,
                           ifelse(ed_d == 13, NA, 2))),
    ed_mom = ifelse(ed_m >= 1 & ed_m <= 5, 0,
                    ifelse(ed_m >= 6 & ed_m <= 9, 1,
                           ifelse(ed_m == 13, NA, 2))),
    income = ifelse(inc == 1|inc == 2, 'Q1',
                    ifelse(inc == 3|inc == 4, 'Q2',
                           ifelse(inc == 5|inc == 6, 'Q3',
                                  ifelse(inc == 7|inc == 8, 'Q4','Q5')))))%>%
  dplyr::select('MRUN', 'gpa', 'NEM', 'RKG', 'LEN', 'MATH', 'gender', 'type_hs', 'sector', 'ed_dad', 'ed_mom', 'income')

c <- application%>%
  dplyr::select(MRUN, SITUACION_POSTULANTE)%>%
  mutate(
    appl = ifelse(SITUACION_POSTULANTE == 'P', 1,0))%>%
  dplyr::select(MRUN, appl)
abc <- left_join(ab, c, by = 'MRUN')

d <- admission%>%
  dplyr::select(MRUN, VIA_ADMISION)%>%
  mutate(
    admitted = ifelse(VIA_ADMISION > 0, 1, 0))%>%
  filter(!is.na(MRUN))%>%
  dplyr::select(MRUN, admitted)%>%
  unique()
abcd <- left_join(abc, d, by = 'MRUN')

colnames(abcd) <- c('ID', 'GPA', 'NEM', 'RKG', 'LEN', 'MATH', 'GENDER', 'TYPE', 'SECTOR', 'ED_DAD', 'ED_MOM', 'INCOME', 'APPLY', 'ADM')

abcd <- abcd%>%
  mutate(
    NEM = ifelse(NEM == 0, NA, NEM),
    RKG = ifelse(RKG == 0, NA, RKG),
    LEN = ifelse(LEN == 0, NA, LEN),
    MATH = ifelse(MATH == 0, NA, MATH),
    dad_miss = ifelse(is.na(ED_DAD), ED_MOM, ED_DAD),
    mom_miss = ifelse(is.na(ED_MOM), ED_DAD, ED_MOM),
    ED_PARENTS = ifelse(dad_miss >= mom_miss, dad_miss, mom_miss),
    Q2 = ifelse(INCOME == 'Q2', 1,0),
    Q3 = ifelse(INCOME == 'Q3', 1,0),
    Q4 = ifelse(INCOME == 'Q4', 1,0),
    Q5 = ifelse(INCOME == 'Q5', 1,0),
    APPLY = ifelse(is.na(APPLY), 0, APPLY),
    ADM = ifelse(is.na(ADM), 0, 1))

data <- abcd%>%
  dplyr::select('GPA', 'NEM', 'RKG', 'LEN', 'MATH', 'GENDER', 'TYPE', 'SECTOR', 'ED_PARENTS', 'Q2', 'Q3', 'Q4', 'Q5', 'APPLY', 'ADM')

summary(data)

rm(a, b, c, d, ab, abc, abcd, admission, application, registration, socioeconomic)
```

```{r}
codebook <- data.frame(cbind(
  Variable = c('GPA','NEM', 'RKG', 'LEN', 'MATH', 'GENDER', 'TYPE', 'SECTOR', 'ED_PARENTS', 'INCOME_Q', 'APPLY', 'ADM'),
  Description = c('High school grade point average.', 'Standardized high school grade point average.', 'Relative position of the student in his or her school of graduation', 'Standardized score in the Language PSU', 'Standardized score in the Mathematics PSU', 'gender of student', 'Type of school, Technical-professional or Humanist, from which the student graduated', "Sector to which the student's school of graduation belongs", 'Higher educational level of the father or mother',"Quintile of economic income to which the student's family belongs (dummy)", "Student's application to a university", 'Admission of the student to a university'),
  Type = c('Continuous','Continuous','Continuous','Continuous','Continuous','Binary (0 = Male, 1 = Female)','Binary (0 = Humanist, 1 = Technical school)','Binary (0 = Public, 1 = Private)','Categorical (0 = Primary, 1 = Secondary, 2 = Tertiary)','Categorical (Q1 [Ref.], Q2, Q3, Q4, Q5)','Binary (0 = Did not apply, 1 = Applied)','Binary (0 = Not admitted, 1 = Admitted)')))
```

The data used corresponds to the University Admission process in Chile during 2021.

276,059

The dataset include:
- 5 background variables – gender, family income, parents’ education, type of high school and sector.
- 5 academic performance variables – GPA, NEM, RKG, PSU Math, and PSU Language.
- 1 admission status variable – whether or not the student is enrolled in a university. Table 1 includes more details:

```{r, include=TRUE, echo=FALSE}
kable(codebook,
      caption = 'Table 1: List of variables')%>%
  kable_styling(bootstrap_options = c('bordered', 'condensed'), full_width = F, position = 'center', font_size =12)%>%
      column_spec(1, italic = T, width = '.75in')
```

## Research questions

1. What is the contribution of academic performance and socioeconomic background variables to the probability of being admitted at the university in Chile?

1.1 What is the single contribution of each predictor (academic performance and socioeconomic background)?

1.2 Is there any difference in probability of being admitted at the university according to socioeconomic status among students?

## Statistical analyses

Binary Logistic Regression. In addition to analyze the estimated probabilities, we will also explore the effect size of the predictors via Odds Ratios.

Rationale for the model proposed
To answer our research questions, we need a classification approach. Due to the binary coded dependent variable (0 = not admitted, 1 = admitted), a binary logistic regression model is appropriate to avoid some of the problems of using a multiple linear regression.

## Bibliography
