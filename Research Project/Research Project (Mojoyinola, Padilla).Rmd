---
title: "<center> <h1>Exploring the probabilities of being admitted to university in Chile based on socioeconomic and academic attributes</h1> </center>"
author:
- name: Mubarak Mojoyinola and Geraldo Padilla
  affiliation: The University of Iowa
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    theme: simplex
    highlight: textmate
  word_document: default
tags:
- PSU
- Admission tests
abstract: |
  This project analyzes the probabilities of being admitted to university in Chile in the 2021 admission process. Admission is based on PSU results and other 2 criteria associated with academic performance during high school (GPA and Ranking), however, there could be  other 'non-academic' criteria interfering in the opportunities to being admitted (socioeconomic background).
---

<style type="text/css">
body{
  font-family: Arial;
  font-size: 12pt;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = F)
```

```{r, messages = F}
library(easypackages)
libraries('tidyverse', 'ggplot2', 'glm2', 'VGAM', 'multcomp', 'stringr', 'readxl', 'Lahman')
```

## Description of data

```{r}
registration <- read_csv2("C:/Users/geral/OneDrive - University of Iowa/CIDCIE/1. Bases de Datos/PSU/PSU 2019 - 2021/A_Inscritos_puntajes/A_INSCRITOS_PUNTAJES_PDT_2021_PUB_MRUN.csv")
```

```{r}
a <- registration%>%
  dplyr::select(MRUN, COD_SEXO, RBD, CODIGO_ENS, RAMA_EDUCACIONAL,
         DEPENDENCIA, PROMEDIO_NOTAS, PTJE_NEM, PTJE_RANKING,
         CLEC_ACTUAL, MATE_ACTUAL, PUNTAJES_PROCESO)%>%
  dplyr::filter(PUNTAJES_PROCESO == 1 & CODIGO_ENS %in% c('310', '410', '510', '610'))%>%
  dplyr::select(MRUN, COD_SEXO, RBD, RAMA_EDUCACIONAL, DEPENDENCIA,
  PROMEDIO_NOTAS, PTJE_NEM, PTJE_RANKING, CLEC_ACTUAL,MATE_ACTUAL)%>%
  mutate(
    gender = ifelse(COD_SEXO == 2, 1,0),
    type_hs = ifelse(RAMA_EDUCACIONAL == 'H1', 0,1),
    sector = ifelse(DEPENDENCIA == 3|DEPENDENCIA == 4, 1,0))%>%
  dplyr::select(MRUN,RBD,PROMEDIO_NOTAS, PTJE_NEM, PTJE_RANKING, CLEC_ACTUAL,MATE_ACTUAL,gender, type_hs,sector)

colnames(a) <- c('MRUN', 'RBD', 'gpa', 'NEM', 'RKG', 'LEN', 'MATH', 'gender', 'type_hs','sector')

#Enseñanza Media H-C niños y jóvenes
#Enseñanza Media Técnico –Profesional Comercial Niños
#Enseñanza Media T-P Industrial Niños
#Enseñanza Media T-P Técnica Niños
```

```{r}
socioeconomic <- read_csv2("C:/Users/geral/OneDrive - University of Iowa/CIDCIE/1. Bases de Datos/PSU/PSU 2019 - 2021/B_Socioeconomico/B_SOCIOECONOMICO_DOMICILIO_PDT_2021_PUB_MRUN.csv")
```

```{r}
b <- socioeconomic%>%
  dplyr::select(MRUN, INGRESO_PERCAPITA_GRUPO_FA, EDUCACION_MADRE, EDUCACION_PADRE)
ab <- left_join(a, b, by = 'MRUN')
```


```{r}
ab <- ab%>%
  mutate(
    inc = INGRESO_PERCAPITA_GRUPO_FA,
    ed_m = EDUCACION_MADRE,
    ed_d = EDUCACION_PADRE,
    ed_dad = ifelse(ed_d >= 0 & ed_d <=5, 0,
                    ifelse(ed_d >= 6 & ed_d <= 9, 1,
                           ifelse(ed_d == 13, NA, 2))),
    ed_mom = ifelse(ed_m >= 1 & ed_m <= 5, 0,
                    ifelse(ed_m >= 6 & ed_m <= 9, 1,
                           ifelse(ed_m == 13, NA, 2))),
    income = ifelse(inc == 1|inc == 2, 'Q1',
                    ifelse(inc == 3|inc == 4, 'Q2',
                           ifelse(inc == 5|inc == 6, 'Q3',
                                  ifelse(inc == 7|inc == 8, 'Q4','Q5')))))%>%
  dplyr::select('MRUN', 'gpa', 'NEM', 'RKG', 'LEN', 'MATH', 'gender', 'type_hs', 'sector', 'ed_dad', 'ed_mom', 'income')
```

```{r}
application <-read_csv2("C:/Users/geral/OneDrive - University of Iowa/CIDCIE/1. Bases de Datos/PSU/PSU 2019 - 2021/C_Postulacion_Seleccion/C_POSTULANTES_SELECCION_PDT_2021_PUB_MRUN.csv")
```

```{r}
c <- application%>%
  dplyr::select(MRUN, SITUACION_POSTULANTE)%>%
  mutate(
    appl = ifelse(SITUACION_POSTULANTE == 'P', 1,0))%>%
  dplyr::select(MRUN, appl)
abc <- left_join(ab, c, by = 'MRUN')
```

```{r}
admission <- read_csv2("C:/Users/geral/OneDrive - University of Iowa/CIDCIE/1. Bases de Datos/PSU/PSU 2019 - 2021/D_Matricula_MRUN/D_MATRICULA_PDT__2021_PUB_MRUN.csv")
```

```{r}
d <- admission%>%
  dplyr::select(MRUN, VIA_ADMISION)%>%
  mutate(
    admitted = ifelse(VIA_ADMISION > 0, 1, 0))%>%
  filter(!is.na(MRUN))%>%
  dplyr::select(MRUN, admitted)%>%
  unique()
abcd <- left_join(abc, d, by = 'MRUN')
```

```{r}
colnames(abcd) <- c('ID', 'GPA', 'NEM', 'RKG', 'LEN', 'MATH', 'GENDER', 'TYPE', 'SECTOR', 'ED_DAD', 'ED_MOM', 'INCOME', 'APPLY', 'ADM')

abcd <- abcd%>%
  mutate(
    NEM = ifelse(NEM == 0, NA, NEM),
    RKG = ifelse(RKG == 0, NA, RKG),
    LEN = ifelse(LEN == 0, NA, LEN),
    MATH = ifelse(MATH == 0, NA, MATH),
    dad_miss = ifelse(is.na(ED_DAD), ED_MOM, ED_DAD),
    mom_miss = ifelse(is.na(ED_MOM), ED_DAD, ED_MOM),
    ED_PARENTS = ifelse(dad_miss >= mom_miss, dad_miss, mom_miss),
    Q2 = ifelse(INCOME == 'Q2', 1,0),
    Q3 = ifelse(INCOME == 'Q3', 1,0),
    Q4 = ifelse(INCOME == 'Q4', 1,0),
    Q5 = ifelse(INCOME == 'Q5', 1,0),
    APPLY = ifelse(is.na(APPLY), 0, APPLY),
    ADM = ifelse(is.na(ADM), 0, 1))

data <- abcd%>%
  dplyr::select('GPA', 'NEM', 'RKG', 'LEN', 'MATH', 'GENDER', 'TYPE', 'SECTOR', 'ED_PARENTS', 'Q2', 'Q3', 'Q4', 'Q5', 'APPLY', 'ADM')
```

The data used corresponds to the University Admission process in Chile during 2018. The dataset includes:
- 4 background variables – gender, family income, parents’ education, and type of high school.
- 3 academic performance variables – GPA, PSU Math, and PSU Language
- 1 admission status variable – being enrolled or not in one university.

## Research questions

1. What is the contribution of academic performance and socioeconomic background variables to the probability of being admitted at the university in Chile?

1.1 What is the single contribution of each predictor (academic performance and socioeconomic background)?

1.2 Is there any difference in probability of being admitted at the university according to socioeconomic status among students?

## Statistical analyses

Binary Logistic Regression. In addition to analyze the estimated probabilities, we will also explore the effect size of the predictors via Odds Ratios.

Rationale for the model proposed
To answer our research questions, we need a classification approach. Due to the binary coded dependent variable (0 = not admitted, 1 = admitted), a binary logistic regression model is appropriate to avoid some of the problems of using a multiple linear regression.
